# MysticStars

A modern horoscope generation platform powered by AI. This application generates personalized horoscope readings using Blackbox AI models and delivers them through a beautiful Next.js web interface.

## Features

- **12 Zodiac Signs** - Complete coverage of all astrological signs with detailed trait information
- **7 Reading Types** - Daily, Weekly, Monthly, Yearly + Love, Career, Health (daily extras)
- **AI-Powered Content** - Readings generated by Blackbox AI with multiple model fallback
- **Modern Next.js Frontend** - Server-side rendered React app with Tailwind CSS
- **Reading Tabs** - Switch between daily/weekly/monthly/yearly readings
- **Lucky Influences** - Daily lucky number, color, and power hour
- **Responsive Design** - Works perfectly on desktop, tablet, and mobile
- **Docker Ready** - Containerized deployment with Docker Compose/Stack

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                        Dokploy Platform                         │
│                    (SSL/Routing/Load Balancer)                  │
└─────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Docker Stack                             │
│  ┌─────────────────┐  ┌─────────────────┐  ┌────────────────┐  │
│  │    Frontend     │  │      API        │  │   PostgreSQL   │  │
│  │    (Next.js)    │──│   (Node.js)     │──│   (Database)   │  │
│  │    Port 3000    │  │   Port 3000     │  │   Port 5432    │  │
│  └─────────────────┘  └─────────────────┘  └────────────────┘  │
│                              │                                  │
│                              ▼                                  │
│                    ┌─────────────────┐                          │
│                    │  Blackbox AI    │                          │
│                    │  (External API) │                          │
│                    └─────────────────┘                          │
└─────────────────────────────────────────────────────────────────┘
```

### Components

1. **Frontend** - Next.js 16 application with React 19
   - Server-side rendering for SEO
   - Tailwind CSS with shadcn/ui components
   - Reading tabs (daily/weekly/monthly/yearly)
   - Love, Career, Health cards (daily only)
   - Lucky influences display

2. **Backend API** - Node.js Express server
   - RESTful API for readings
   - Rate limiting with health check bypass
   - Sequelize ORM with PostgreSQL

3. **Database** - PostgreSQL 15
   - Stores generated readings with validity periods
   - Auto-initialized via Sequelize on startup

4. **AI Service** - Blackbox AI integration
   - Multiple free models with automatic fallback
   - Customized prompts per reading type

## Quick Start

### Prerequisites

- Docker and Docker Compose
- Blackbox AI API key (get one at [blackbox.ai](https://blackbox.ai))

### Local Development

1. **Clone the repository**
   ```bash
   git clone https://github.com/jcowey/mysticstars.git
   cd mysticstars
   ```

2. **Set up environment variables**
   ```bash
   cp .env.example .env
   # Edit .env with your configuration
   ```

3. **Start with Docker Compose**
   ```bash
   docker-compose up -d
   ```

4. **Initialize readings** (first time only)
   ```bash
   docker exec mysticstars-api node scripts/generateReadings.js daily
   docker exec mysticstars-api node scripts/generateReadings.js weekly
   docker exec mysticstars-api node scripts/generateReadings.js monthly
   docker exec mysticstars-api node scripts/generateReadings.js yearly
   ```

5. **Access the application**
   - Frontend: http://localhost:3001
   - API: http://localhost:3000

### Backend Development

```bash
cd backend
cp .env.example .env
npm install
npm run dev
```

### Frontend Development

```bash
cd new-frontend
pnpm install
pnpm dev
```

## Production Deployment (Dokploy)

### 1. GitHub Actions

Push to the `main` branch triggers automatic image builds:

- `ghcr.io/jcowey/mysticstars/api:latest`
- `ghcr.io/jcowey/mysticstars/frontend:latest`

Images are pushed to GitHub Container Registry (GHCR).

### 2. Dokploy Configuration

Create a new Docker Compose project in Dokploy and use `docker-stack.yml`.

### 3. Environment Variables

Configure these environment variables in Dokploy:

| Variable | Service | Description |
|----------|---------|-------------|
| `POSTGRES_USER` | postgres | Database username |
| `POSTGRES_PASSWORD` | postgres | Database password (generate secure) |
| `POSTGRES_DB` | postgres | Database name |
| `NODE_ENV` | api, frontend | Set to `production` |
| `POSTGRES_URI` | api | `postgresql://user:pass@postgres:5432/dbname` |
| `BLACKBOX_API_KEY` | api | Your Blackbox AI API key |
| `FRONTEND_URL` | api | Your domain (e.g., `https://mysticstars.app`) |

### 4. Database Initialization

After first deployment, the database tables are auto-created. Populate readings:

```bash
# Via Dokploy console or docker exec
docker exec mysticstars-api node scripts/generateReadings.js daily
docker exec mysticstars-api node scripts/generateReadings.js weekly
docker exec mysticstars-api node scripts/generateReadings.js monthly
docker exec mysticstars-api node scripts/generateReadings.js yearly
```

### 5. Scheduled Reading Generation

Set up a cron job to regenerate daily readings. In Dokploy or externally:

```bash
# Daily at 1:00 AM UTC
0 1 * * * docker exec mysticstars-api node scripts/generateReadings.js daily

# Weekly on Sunday at 2:00 AM UTC
0 2 * * 0 docker exec mysticstars-api node scripts/generateReadings.js weekly

# Monthly on the 1st at 3:00 AM UTC
0 3 1 * * docker exec mysticstars-api node scripts/generateReadings.js monthly

# Yearly on Jan 1st at 4:00 AM UTC
0 4 1 1 * docker exec mysticstars-api node scripts/generateReadings.js yearly
```

## API Endpoints

### Health Check
- `GET /api/health` - Basic health status
- `GET /api/health/live` - Liveness probe
- `GET /api/health/ready` - Readiness probe

### Readings
- `GET /api/readings/:sign` - Get all readings for a sign
- `GET /api/readings/:sign/:type` - Get specific reading type
- `GET /api/readings/:sign/complete` - Get daily + love/career/health + lucky
- `GET /api/readings/status` - API statistics

### Example Response

```json
{
  "success": true,
  "zodiacSign": "aries",
  "data": {
    "daily": "Today brings exciting opportunities...",
    "love": "Your romantic energy is magnetic...",
    "career": "Professional momentum builds...",
    "health": "Focus on balance and rest...",
    "lucky": {
      "number": 7,
      "color": "Crimson Red",
      "time": "2:30 PM"
    }
  },
  "validFrom": "2026-01-24T00:00:00.000Z",
  "validUntil": "2026-01-26T00:00:00.000Z"
}
```

## Manual Reading Generation

```bash
# Generate all daily readings (includes love, career, health)
node scripts/generateReadings.js daily

# Generate specific type for all signs
node scripts/generateReadings.js weekly
node scripts/generateReadings.js monthly
node scripts/generateReadings.js yearly

# Regenerate single sign/type
node scripts/generateReadings.js regen aries daily
node scripts/generateReadings.js regen leo weekly
```

## Environment Variables Reference

### Backend (.env)

```bash
# Application
NODE_ENV=production
PORT=3000

# Database
POSTGRES_USER=mysticstars
POSTGRES_PASSWORD=secure_password_here
POSTGRES_DB=mysticstars
POSTGRES_URI=postgresql://mysticstars:password@postgres:5432/mysticstars

# AI Service
BLACKBOX_API_KEY=your_api_key_here

# URLs
API_BASE_URL=http://api:3000
FRONTEND_URL=https://yourdomain.com
```

### Frontend

```bash
NODE_ENV=production
# Note: NEXT_PUBLIC_API_URL is baked in at build time
# The frontend uses internal Docker networking (http://api:3000) for SSR
```

## Tech Stack

- **Frontend**: Next.js 16, React 19, Tailwind CSS, shadcn/ui, Framer Motion
- **Backend**: Node.js, Express, Sequelize ORM
- **Database**: PostgreSQL 15
- **AI**: Blackbox AI (multiple model fallback)
- **Infrastructure**: Docker, GitHub Actions, Dokploy

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Submit a pull request

## License

MIT License - see LICENSE file for details.
